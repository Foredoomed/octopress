
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Zhixingheyi</title>
  <meta name="author" content="Foredoomed">

  
  <meta name="description" content="浏览器可能是目前使用的人最多的软件，对于软件开发人员来说更是如此。我对浏览器的认识差不多是这样的： 发送请求到服务器(get/post) 解析从服务器返回的response(HTML,CSS) 执行JavaScript代码 基本上就是上面这些，但是至于细节就不了解了。直到我看到了这篇长长的文章： &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://liuxuan.info/blog/page/3/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/zhixingheyi" rel="alternate" title="Zhixingheyi" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css">


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-17293168-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Zhixingheyi</a></h1>
  
    <h2>Just for fun!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/zhixingheyi" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:liuxuan.info" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/05/how-browsers-work-one/">浏览器是如何工作的(一)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-05T23:03:00+08:00" pubdate data-updated="true">Dec 5<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/12/05/how-browsers-work-one/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>浏览器可能是目前使用的人最多的软件，对于软件开发人员来说更是如此。我对浏览器的认识差不多是这样的：</p>

<ul>
  <li>发送请求到服务器(get/post)</li>
  <li>解析从服务器返回的response(HTML,CSS)</li>
  <li>执行JavaScript代码</li>
</ul>

<p>基本上就是上面这些，但是至于细节就不了解了。直到我看到了这篇长长的文章：<a href="http://www.html5rocks.com/en/tutorials/internals/howbrowserswork/" title="How Browsers Work:Behind the Scenes of Modern Web Browsers">How Browsers Work:Behind the Scenes of Modern Web Browsers</a>,才第一次窥探到了浏览器的处理细节。这个主题一共分成了10章来讲，对于学习和参考浏览器的工作原理都非常有用。所以，我就决定把它翻译成中文，供以后参考用。值得一提的是，这篇文章的作者是一个有着10年以上经验的女程序员，让我们像她致敬！</p>

<p>由于原文较长，所以我也会分成几篇博客来翻，而这篇博客是这个系列的第一篇翻译。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/12/05/how-browsers-work-one/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/03/what-does-jit-do-in-hotspot/">JIT到底做了些什么事</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-03T15:15:00+08:00" pubdate data-updated="true">Dec 3<span>rd</span>, 2011</time>
        
         | <a href="/blog/2011/12/03/what-does-jit-do-in-hotspot/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近在网上看到一篇关JIT(Just in Time)的文章<a href="http://java.dzone.com/articles/just-time-compiler-jit-hotspot?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+javalobby%2Ffrontpage+%28Javalobby+%2F+Java+Zone%29&amp;utm_content=Google+Reader" title="Just in Time Compiler (JIT) in Hotspot">Just in Time Compiler (JIT) in Hotspot</a>,这篇文章很短，但是对JIT的作用基本上说的比较清楚的，可以作为JIT的学习参考，所以我就决定把这篇文章翻译成中文，供以后复习参考用。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/12/03/what-does-jit-do-in-hotspot/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/11/17/my-macbook-life-starts/">我的Macbook Pro之旅正式开始了</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-17T23:36:00+08:00" pubdate data-updated="true">Nov 17<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/11/17/my-macbook-life-starts/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近一直感觉现在用的笔记本有点慢，特别是打开eclipse的话要等上最起码半分钟时间，这对于我来说是不能忍受的。所以我决定鸟枪换炮，把从大学时期开始就陪伴着我到现在的IBM R60给我爸用，我自己就再去买台笔记本电脑。</p>

<p>目标其实早就决定了，在今年年初定的<a href="http://liuxuan.info/blog/2011/01/01/plans-for-2011" title="2011年的计划">2011年的计划</a>里我就希望今年能够买个苹果笔记本，终于快到了年末的时候实现了。这次我买的是13寸版的MBP MD313，这个是刚刚上市不久的型号，较年初的版本有了一点的升级，比如CPU主频提高了，硬盘加多了等，总之是一款非常适合入手的笔记本电脑。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/11/17/my-macbook-life-starts/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/11/10/lang-chao-zhi-dian-note/">读《浪潮之巅》有感</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-10T22:43:00+08:00" pubdate data-updated="true">Nov 10<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/11/10/lang-chao-zhi-dian-note/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近终于把《浪潮之巅》看完了，当最后一页合上之后我感慨万千，就像穿过了时空隧道一样经历了那些在IT界非常有名的大公司从创立到达到顶峰，潮起和潮落，成长和落败。这是一本IT界的历史书，它几乎囊括了整个IT界的发展史，但是要把它写的简单易读是非常不容易的，但是这位作者做到了，即使不是计算机专业的人也能很容易的读懂。</p>

<p>读完整本书后，最令我感到唏嘘的就是Sun公司。当初Sun公司的James Gosling发明了Java，以其跨平台特性风靡全球，至今还在编程语言榜上排名第一，而我现在还在靠Java吃饭，但是不幸的是Sun公司已经被Oracle收购，不再作为一个独立的公司存在了。太多的实例告诉我们，一个公司光有技术还不行，要在这个竞争激烈的世界生存下去必须要有一个卓越的领导者带领着这个公司不断前进。而Sun公司就缺这么一个领导者，这不得不说是种遗憾。</p>

<p>Google是我一直非常喜欢的公司，而作者用了很长的篇幅介绍了Google这家公司，正好让我更全面地了解了这家公司。但是现在的Google给人有点微软的感觉，而Facebook给人的感觉就是以前的Google。作者也说了，明年Facebook就会上市，这件事也许也会是2012年IT界最令人激动振奋的一件事，那就让我一起等待2012年4月28日这天的到来吧。</p>

<p>唯一感到有点遗憾的是作者只用了很少的篇幅来讲述twitter这家公司，而twitter又是我非常喜欢的应用，虽然在中国因为众所周知的原因无法使用twitter，但这并不会阻止我对它的向往。twitter已经是我获取信息的重要来源，甚至已经超过了电视和门户网站，我现在还把上twitter衡量为一种价值观取向。</p>

<p>世界在不断的发展，还会有更多的公司脱颖而出，谁会是下一个Google和Facebook呢，让我们拭目以待吧。</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/11/08/switching-from-wordpress-to-octopress/">告别Wordpress,拥抱Octopress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-08T22:49:00+08:00" pubdate data-updated="true">Nov 8<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/11/08/switching-from-wordpress-to-octopress/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>至今为止我开博有差不多1年多时间了，期间一直是用Wordpress搭建的博客系统。Wordpress虽然是目前最流行的博客系统，但是如果要在自己的VPS上搭建Wordpress环境还是有一定难度的(我当初搭建的时候就花了蛮长的时间，搭建完了还要优化)。当然最主要的还是用下来有许多的不方便的地方：</p>

<ul>
  <li>因为不懂PHP，所以修改功能起来比较麻烦</li>
  <li>对“&lt;”等特殊符号需要手动转义</li>
  <li>需要安装很多插件才能满足需要</li>
  <li>Nginx+PHP+mySql的组合在小内存的VPS上内存占用率过高(在我256MB内存的VPS上达到了30%)</li>
</ul>

<p>直到上个星期在Google Reader上看到有人提到[Octopress]{http://octopress.org/ “Octopress”}这个用Ruby写的博客系统后，就一下子被它的简单轻量所吸引(只要一个Web服务器就行了，不需要mySql)，最终要的是我会Ruby，所以我毫不犹豫的决定从Wordpress转向Octopress。而且在Octopress的主页上还写着这样一句话：A blogging framework for hackers.恩，我就是个hacker，哈哈。</p>

<p>整个安装过程还是比较简单的，不过在安装之前要先把之前的博客导出来(不管是从后台还是数据库导)，然后就可以按照<a href="http://octopress.org/docs/setup/" title="Octopress Setup">Octopress Setup</a>来安装了。注意，如果没有装过Ruby的话，那么在安装完<a href="http://beginrescueend.com/" title="RVM">RVM</a>后需要安装Ruby的依赖库：</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">yum install -y gcc-c++ patch readline readline-devel zlib zlib-devel libyaml-devel libffi-devel openssl-devel make bzip2 autoconf automake libtool bison iconv-devel
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>git的话只需要运行命令：</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">yum install git-core
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>我的VPS的操作系统是CentOS 6，并且我把预装的Apache给卸载了，改用Nginx。顺便提一下，在编译Nginx的时候如果碰到编译错误，那就试试下面这句命令行吧：</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">yum install pcre-devel
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>然后修改Nginx的配置文件nginx.conf</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
</pre></td><td class="code"><pre><code class=""><span class="line">user  root;
</span><span class="line">worker_processes  1;
</span><span class="line">
</span><span class="line">error_log  logs/error.log crit;
</span><span class="line">#error_log  logs/error.log  notice;
</span><span class="line">#error_log  logs/error.log  info;
</span><span class="line">
</span><span class="line">pid        logs/nginx.pid;
</span><span class="line">
</span><span class="line">worker_rlimit_nofile 65535;
</span><span class="line">
</span><span class="line">events {
</span><span class="line">    use epoll;
</span><span class="line">    worker_connections  65535;
</span><span class="line">}
</span><span class="line">
</span><span class="line">http {
</span><span class="line">    include       mime.types;
</span><span class="line">    default_type  application/octet-stream;
</span><span class="line">
</span><span class="line">    server_names_hash_bucket_size 128;
</span><span class="line">    large_client_header_buffers 4 32k;
</span><span class="line">    client_header_buffer_size 32k; 
</span><span class="line">    client_max_body_size 8m;
</span><span class="line">      
</span><span class="line">    sendfile on;
</span><span class="line">    keepalive_timeout 10 10;
</span><span class="line">    tcp_nopush on;
</span><span class="line">    tcp_nodelay on;
</span><span class="line">    
</span><span class="line">    fastcgi_connect_timeout 300;
</span><span class="line">    fastcgi_send_timeout 300;
</span><span class="line">    fastcgi_read_timeout 300;
</span><span class="line">    fastcgi_buffer_size 32k;
</span><span class="line">    fastcgi_buffers 4 32k;
</span><span class="line">    fastcgi_busy_buffers_size 32k;
</span><span class="line">    fastcgi_temp_file_write_size 32k;
</span><span class="line">    fastcgi_intercept_errors on;
</span><span class="line">
</span><span class="line">    gzip  on;
</span><span class="line">    gzip_min_length  1k;
</span><span class="line">    gzip_buffers     4 16k;
</span><span class="line">    gzip_http_version 1.0;
</span><span class="line">    gzip_comp_level 1;
</span><span class="line">    gzip_types       text/plain application/x-javascript text/css application/xml;
</span><span class="line">    gzip_vary on;
</span><span class="line">
</span><span class="line">    server {
</span><span class="line">        listen       80;
</span><span class="line">        server_name  liuxuan.info www.liuxuan.info;
</span><span class="line">        
</span><span class="line">        log_format  access  '$remote_addr - $remote_user [$time_local] "$request" '
</span><span class="line">                            '$status $body_bytes_sent "$http_referer" '
</span><span class="line">                            '"$http_user_agent" $http_x_forwarded_for';
</span><span class="line">        
</span><span class="line">        access_log  logs/host.access.log  access;
</span><span class="line">
</span><span class="line">        location / {
</span><span class="line">            root   /path/to/octopress/public;
</span><span class="line">            index  index.html;
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        #error_page  404              /404.html;
</span><span class="line">
</span><span class="line">        # redirect server error pages to the static page /50x.html
</span><span class="line">        #
</span><span class="line">        error_page   500 502 503 504  /50x.html;
</span><span class="line">        location = /50x.html {
</span><span class="line">            root   html;
</span><span class="line">        }
</span><span class="line">  
</span><span class="line">    }
</span><span class="line">
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>创建Nginx自动启动脚本</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">vim /etc/init.d/nginx
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>然后加入下面的内容</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c">#!/bin/sh</span>
</span><span class="line"><span class="c">#</span>
</span><span class="line"><span class="c"># nginx - this script starts and stops the nginx daemin</span>
</span><span class="line"><span class="c">#</span>
</span><span class="line"><span class="c"># chkconfig:   - 85 15 </span>
</span><span class="line"><span class="c"># description:  Nginx is an HTTP(S) server, HTTP(S) reverse \</span>
</span><span class="line"><span class="c">#               proxy and IMAP/POP3 proxy server</span>
</span><span class="line"><span class="c"># processname: nginx</span>
</span><span class="line"><span class="c"># config:      /usr/local/nginx/conf/nginx.conf</span>
</span><span class="line"><span class="c"># pidfile:     /usr/local/nginx/logs/nginx.pid</span>
</span><span class="line">
</span><span class="line"><span class="c"># Source function library.</span>
</span><span class="line">. /etc/rc.d/init.d/functions
</span><span class="line">
</span><span class="line"><span class="c"># Source networking configuration.</span>
</span><span class="line">. /etc/sysconfig/network
</span><span class="line">
</span><span class="line"><span class="c"># Check that networking is up.</span>
</span><span class="line"><span class="o">[</span> <span class="s2">&quot;$NETWORKING&quot;</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">exit </span>0
</span><span class="line">
</span><span class="line"><span class="nv">nginx</span><span class="o">=</span><span class="s2">&quot;/usr/local/nginx/sbin/nginx&quot;</span>
</span><span class="line"><span class="nv">prog</span><span class="o">=</span><span class="k">$(</span>basename <span class="nv">$nginx</span><span class="k">)</span>
</span><span class="line">
</span><span class="line"><span class="nv">NGINX_CONF_FILE</span><span class="o">=</span><span class="s2">&quot;/usr/local/nginx/conf/nginx.conf&quot;</span>
</span><span class="line">
</span><span class="line"><span class="nv">lockfile</span><span class="o">=</span>/var/lock/subsys/nginx
</span><span class="line">
</span><span class="line">start<span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="o">[</span> -x <span class="nv">$nginx</span> <span class="o">]</span> <span class="o">||</span> <span class="nb">exit </span>5
</span><span class="line">    <span class="o">[</span> -f <span class="nv">$NGINX_CONF_FILE</span> <span class="o">]</span> <span class="o">||</span> <span class="nb">exit </span>6
</span><span class="line">    <span class="nb">echo</span> -n <span class="s2">$&quot;Starting $prog: &quot;</span>
</span><span class="line">    daemon <span class="nv">$nginx</span> -c <span class="nv">$NGINX_CONF_FILE</span>
</span><span class="line">    <span class="nv">retval</span><span class="o">=</span><span class="nv">$?</span>
</span><span class="line">    <span class="nb">echo</span>
</span><span class="line">    <span class="o">[</span> <span class="nv">$retval</span> -eq 0 <span class="o">]</span> <span class="o">&amp;&amp;</span> touch <span class="nv">$lockfile</span>
</span><span class="line">    <span class="k">return</span> <span class="nv">$retval</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line">stop<span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="nb">echo</span> -n <span class="s2">$&quot;Stopping $prog: &quot;</span>
</span><span class="line">    killproc <span class="nv">$prog</span> -QUIT
</span><span class="line">    <span class="nv">retval</span><span class="o">=</span><span class="nv">$?</span>
</span><span class="line">    <span class="nb">echo</span>
</span><span class="line">    <span class="o">[</span> <span class="nv">$retval</span> -eq 0 <span class="o">]</span> <span class="o">&amp;&amp;</span> rm -f <span class="nv">$lockfile</span>
</span><span class="line">    <span class="k">return</span> <span class="nv">$retval</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line">restart<span class="o">()</span> <span class="o">{</span>
</span><span class="line">    configtest <span class="o">||</span> <span class="k">return</span> <span class="nv">$?</span>
</span><span class="line">    stop
</span><span class="line">    start
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line">reload<span class="o">()</span> <span class="o">{</span>
</span><span class="line">    configtest <span class="o">||</span> <span class="k">return</span> <span class="nv">$?</span>
</span><span class="line">    <span class="nb">echo</span> -n <span class="s2">$&quot;Reloading $prog: &quot;</span>
</span><span class="line">    killproc <span class="nv">$nginx</span> -HUP
</span><span class="line">    <span class="nv">RETVAL</span><span class="o">=</span><span class="nv">$?</span>
</span><span class="line">    <span class="nb">echo</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line">force_reload<span class="o">()</span> <span class="o">{</span>
</span><span class="line">    restart
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line">configtest<span class="o">()</span> <span class="o">{</span>
</span><span class="line">  <span class="nv">$nginx</span> -t -c <span class="nv">$NGINX_CONF_FILE</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line">rh_status<span class="o">()</span> <span class="o">{</span>
</span><span class="line">    status <span class="nv">$prog</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line">rh_status_q<span class="o">()</span> <span class="o">{</span>
</span><span class="line">    rh_status &gt;/dev/null 2&gt;&amp;1
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="k">case</span> <span class="s2">&quot;$1&quot;</span> in
</span><span class="line">    start<span class="o">)</span>
</span><span class="line">        rh_status_q <span class="o">&amp;&amp;</span> <span class="nb">exit </span>0
</span><span class="line">        <span class="nv">$1</span>
</span><span class="line">        ;;
</span><span class="line">    stop<span class="o">)</span>
</span><span class="line">        rh_status_q <span class="o">||</span> <span class="nb">exit </span>0
</span><span class="line">        <span class="nv">$1</span>
</span><span class="line">        ;;
</span><span class="line">    restart|configtest<span class="o">)</span>
</span><span class="line">        <span class="nv">$1</span>
</span><span class="line">        ;;
</span><span class="line">    reload<span class="o">)</span>
</span><span class="line">        rh_status_q <span class="o">||</span> <span class="nb">exit </span>7
</span><span class="line">        <span class="nv">$1</span>
</span><span class="line">        ;;
</span><span class="line">    force-reload<span class="o">)</span>
</span><span class="line">        force_reload
</span><span class="line">        ;;
</span><span class="line">    status<span class="o">)</span>
</span><span class="line">        rh_status
</span><span class="line">        ;;
</span><span class="line">    condrestart|try-restart<span class="o">)</span>
</span><span class="line">        rh_status_q <span class="o">||</span> <span class="nb">exit </span>0
</span><span class="line">            ;;
</span><span class="line">    *<span class="o">)</span>
</span><span class="line">        <span class="nb">echo</span> <span class="s2">$&quot;Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}&quot;</span>
</span><span class="line">        <span class="nb">exit </span>2
</span><span class="line"><span class="k">esac</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>添加可执行权限</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">chmod +x /etc/init.d/nginx
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>配置开机自启动</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">chkconfig nginx on
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>安装完成后顺便对CentOS做一下优化，用<a href="http://www.balabit.com/network-security/syslog-ng/opensource-logging-system" title="syslog-ng">syslog-ng</a>替换rsyslog，删除不需要的进程。然后调整Linux的最大文件打开数：</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">vim /etc/security/limits.conf
</span><span class="line">在最后一行添加
</span><span class="line">* soft nofile 65535
</span><span class="line">* hard nofile 65535
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>整个搭建过程在30分钟之内就可以搞定，大大低于搭建Wordpress环境所需要的时间。而且通过top命令可以看到由于只有一个Nginx进程，所以整个内存占用率在4%左右，大大低于Wordpress的30%，这点对于小内存的VPS是非常有优势的。</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/24/mybatis-source-code-analysis-mapping/">myBatis源码分析之映射</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-24T20:35:00+08:00" pubdate data-updated="true">Oct 24<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/10/24/mybatis-source-code-analysis-mapping/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>1.包结构分析</strong></p>

<table border="1" width="100%" cellpadding="3" cellspacing="0" summary="">
<tbody><tr>
<th align="left" colspan="2" style="background-color:#CCCCFF">
<b>Packages</b></th></tr>
<tr bgcolor="white">
<td width="20%"><b>org.apache.ibatis.builder</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>org.apache.ibatis.builder.annotation</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>org.apache.ibatis.builder.xml</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>org.apache.ibatis.mapping</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>org.apache.ibatis.parsing</b></td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>

<p>myBatis在XML解析方面的包结构相对于iBatis精简了不少，而且还加入了对注解的支持。在myatis中除了在XML文件内映射SQ外，我们还可以用注解来映射SQL。当然，这样做的好处和坏处都有，网上讨论也很多，在选择的时候要做好充分考虑。</p>

<p><strong>2.源码分析</strong></p>

<p>myBatis相对于iBatis变化还是很大的，iBatis的客户端接口SqlMapClient在myBatis中已经不复存在，取而代之的是SqlSession接口，接下来我们就来看看SqlSession接口是怎么创建的。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>SqlSessionFactoryBuilder.java  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">public</span> <span class="n">SqlSessionFactory</span> <span class="nf">build</span><span class="o">(</span><span class="n">Reader</span> <span class="n">reader</span><span class="o">,</span> <span class="n">String</span> <span class="n">environment</span><span class="o">,</span> <span class="n">Properties</span> <span class="n">properties</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="k">try</span> <span class="o">{</span>
</span><span class="line">      <span class="n">XMLConfigBuilder</span> <span class="n">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XMLConfigBuilder</span><span class="o">(</span><span class="n">reader</span><span class="o">,</span> <span class="n">environment</span><span class="o">,</span> <span class="n">properties</span><span class="o">);</span>
</span><span class="line">      <span class="k">return</span> <span class="nf">build</span><span class="o">(</span><span class="n">parser</span><span class="o">.</span><span class="na">parse</span><span class="o">());</span>
</span><span class="line">    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">      <span class="k">throw</span> <span class="n">ExceptionFactory</span><span class="o">.</span><span class="na">wrapException</span><span class="o">(</span><span class="s">&quot;Error building SqlSession.&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class="line">    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class="line">      <span class="n">ErrorContext</span><span class="o">.</span><span class="na">instance</span><span class="o">().</span><span class="na">reset</span><span class="o">();</span>
</span><span class="line">      <span class="k">try</span> <span class="o">{</span>
</span><span class="line">        <span class="n">reader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class="line">      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">        <span class="c1">// Intentionally ignore. Prefer previous error.</span>
</span><span class="line">      <span class="o">}</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="kd">public</span> <span class="n">SqlSessionFactory</span> <span class="nf">build</span><span class="o">(</span><span class="n">Configuration</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="k">return</span> <span class="k">new</span> <span class="nf">DefaultSqlSessionFactory</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>在SqlSessionFactoryBuilder中定义了许多重载的build方法，其他build方法再调用上面的有三个参数的build方法，在其中创建XMLConfigBuilder对象解析XML文件，然后再调用以Configuration为参数的build方法返回DefaultSqlSessionFactory对象。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>XMLConfigBuilder.java  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">parseConfiguration</span><span class="o">(</span><span class="n">XNode</span> <span class="n">root</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="k">try</span> <span class="o">{</span>
</span><span class="line">      <span class="n">typeAliasesElement</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">evalNode</span><span class="o">(</span><span class="s">&quot;typeAliases&quot;</span><span class="o">));</span>
</span><span class="line">      <span class="n">pluginElement</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">evalNode</span><span class="o">(</span><span class="s">&quot;plugins&quot;</span><span class="o">));</span>
</span><span class="line">      <span class="n">objectFactoryElement</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">evalNode</span><span class="o">(</span><span class="s">&quot;objectFactory&quot;</span><span class="o">));</span>
</span><span class="line">      <span class="n">objectWrapperFactoryElement</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">evalNode</span><span class="o">(</span><span class="s">&quot;objectWrapperFactory&quot;</span><span class="o">));</span>
</span><span class="line">      <span class="n">propertiesElement</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">evalNode</span><span class="o">(</span><span class="s">&quot;properties&quot;</span><span class="o">));</span>
</span><span class="line">      <span class="n">settingsElement</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">evalNode</span><span class="o">(</span><span class="s">&quot;settings&quot;</span><span class="o">));</span>
</span><span class="line">      <span class="n">environmentsElement</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">evalNode</span><span class="o">(</span><span class="s">&quot;environments&quot;</span><span class="o">));</span>
</span><span class="line">      <span class="n">typeHandlerElement</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">evalNode</span><span class="o">(</span><span class="s">&quot;typeHandlers&quot;</span><span class="o">));</span>
</span><span class="line">      <span class="n">mapperElement</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">evalNode</span><span class="o">(</span><span class="s">&quot;mappers&quot;</span><span class="o">));</span>
</span><span class="line">    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">      <span class="k">throw</span> <span class="k">new</span> <span class="nf">BuilderException</span><span class="o">(</span><span class="s">&quot;Error parsing SQL Mapper Configuration. Cause: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">  <span class="o">}</span>
</span><span class="line">
</span><span class="line">  <span class="o">...</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>XMLConfigBuilder类也重载了许多的构造方法，但是最终调用的还是有三个参数的构造方法。在parse方法中调用parseConfiguration方法解析在configuration.xml中所有的配置项。myBatis定义了一个XNode类用来辅助解析：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>XNode.java  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">  <span class="kd">private</span> <span class="n">Properties</span> <span class="nf">parseAttributes</span><span class="o">(</span><span class="n">Node</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="n">Properties</span> <span class="n">attributes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span><span class="line">    <span class="n">NamedNodeMap</span> <span class="n">attributeNodes</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">();</span>
</span><span class="line">    <span class="k">if</span> <span class="o">(</span><span class="n">attributeNodes</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">attributeNodes</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class="line">        <span class="n">Node</span> <span class="n">attribute</span> <span class="o">=</span> <span class="n">attributeNodes</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span><span class="line">        <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">PropertyParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">attribute</span><span class="o">.</span><span class="na">getNodeValue</span><span class="o">(),</span> <span class="n">variables</span><span class="o">);</span>
</span><span class="line">        <span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">attribute</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">(),</span> <span class="n">value</span><span class="o">);</span>
</span><span class="line">      <span class="o">}</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">    <span class="k">return</span> <span class="n">attributes</span><span class="o">;</span>
</span><span class="line">  <span class="o">}</span>
</span><span class="line">
</span><span class="line">  <span class="kd">private</span> <span class="n">Object</span> <span class="nf">evaluate</span><span class="o">(</span><span class="n">String</span> <span class="n">expression</span><span class="o">,</span> <span class="n">Object</span> <span class="n">root</span><span class="o">,</span> <span class="n">QName</span> <span class="n">returnType</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="k">try</span> <span class="o">{</span>
</span><span class="line">      <span class="k">return</span> <span class="n">xpath</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">expression</span><span class="o">,</span> <span class="n">root</span><span class="o">,</span> <span class="n">returnType</span><span class="o">);</span>
</span><span class="line">    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">      <span class="k">throw</span> <span class="k">new</span> <span class="nf">BuilderException</span><span class="o">(</span><span class="s">&quot;Error evaluating XPath.  Cause: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>在XPathParser类中读取XML文件流创建Document类，而且其中定义了许多evalXXX方法，而后最终调用的是XPath类的evaluate方法。而且在XNode中一个SQL的映射片段XML会被解析后存放到一个Properties类中。那么现在就能明白为什么与解析相关的包精简了很多：就是因为iBatis是用SAX方式解析，而myBatis直接调用JDK自带的XPath的API解析，所以省去了许多工作，不用去自定义元素类型，这样做的结果就是整个包结构得到了精简，而且解析性能更好。</p>

<p>下面来看一下SQL的映射过程：首先在XMLConfigBuilder中的mapperElement方法中会创建XMLMapperBuilder对象，然后再调用它的parse方法。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>XMLMapperBuilder.java  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">parsePendingStatements</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">	  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">xmlstatementbuilder</span><span class="o">&gt;</span> <span class="n">incompleteStatements</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="na">getIncompleteStatements</span><span class="o">();</span>
</span><span class="line">	  <span class="kd">synchronized</span> <span class="o">(</span><span class="n">incompleteStatements</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">		  <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">xmlstatementbuilder</span><span class="o">&gt;</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">incompleteStatements</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
</span><span class="line">		  <span class="k">while</span> <span class="o">(</span><span class="n">iter</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
</span><span class="line">			  <span class="k">try</span> <span class="o">{</span>
</span><span class="line">				  <span class="n">iter</span><span class="o">.</span><span class="na">next</span><span class="o">().</span><span class="na">parseStatementNode</span><span class="o">();</span>
</span><span class="line">				  <span class="n">iter</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
</span><span class="line">			  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IncompleteStatementException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">				  <span class="c1">// Statement is still missing a resource...</span>
</span><span class="line">			  <span class="o">}</span>
</span><span class="line">		  <span class="o">}</span>
</span><span class="line">	  <span class="o">}</span>
</span><span class="line">  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>我们可以看到在parsePendingStatements方法中调用的是XMLStatementBuilder的parseStatementNode方法，所以我们继续跟踪。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>XMLStatementBuilder.java  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">parseStatementNode</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="o">...</span>
</span><span class="line">
</span><span class="line">    <span class="n">SqlSource</span> <span class="n">sqlSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DynamicSqlSource</span><span class="o">(</span><span class="n">configuration</span><span class="o">,</span> <span class="n">rootSqlNode</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="o">...</span>
</span><span class="line">  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>SQL的配置被读取进来后保存到了SqlSource接口的实例DynamicSqlSource类中，其他是对参数，返回值和主键的解析。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>DynamicSqlSource.java  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">  <span class="kd">public</span> <span class="n">BoundSql</span> <span class="nf">getBoundSql</span><span class="o">(</span><span class="n">Object</span> <span class="n">parameterObject</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="n">DynamicContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DynamicContext</span><span class="o">(</span><span class="n">configuration</span><span class="o">,</span> <span class="n">parameterObject</span><span class="o">);</span>
</span><span class="line">    <span class="n">rootSqlNode</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span><span class="line">    <span class="n">SqlSourceBuilder</span> <span class="n">sqlSourceParser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SqlSourceBuilder</span><span class="o">(</span><span class="n">configuration</span><span class="o">);</span>
</span><span class="line">    <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">parameterType</span> <span class="o">=</span> <span class="n">parameterObject</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span> <span class="o">:</span> <span class="n">parameterObject</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
</span><span class="line">    <span class="n">SqlSource</span> <span class="n">sqlSource</span> <span class="o">=</span> <span class="n">sqlSourceParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getSql</span><span class="o">(),</span> <span class="n">parameterType</span><span class="o">);</span>
</span><span class="line">    <span class="n">BoundSql</span> <span class="n">boundSql</span> <span class="o">=</span> <span class="n">sqlSource</span><span class="o">.</span><span class="na">getBoundSql</span><span class="o">(</span><span class="n">parameterObject</span><span class="o">);</span>
</span><span class="line">    <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">string</span> <span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">context</span><span class="o">.</span><span class="na">getBindings</span><span class="o">().</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span><span class="line">      <span class="n">boundSql</span><span class="o">.</span><span class="na">setAdditionalParameter</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">    <span class="k">return</span> <span class="n">boundSql</span><span class="o">;</span>
</span><span class="line">  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>没什么好说的，创建SqlSourceBuilder类再调用它的parse方法。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>SqlSourceBuilder.java  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">  <span class="kd">public</span> <span class="n">SqlSource</span> <span class="nf">parse</span><span class="o">(</span><span class="n">String</span> <span class="n">originalSql</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">parameterType</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="n">ParameterMappingTokenHandler</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ParameterMappingTokenHandler</span><span class="o">(</span><span class="n">configuration</span><span class="o">,</span> <span class="n">parameterType</span><span class="o">);</span>
</span><span class="line">    <span class="n">GenericTokenParser</span> <span class="n">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GenericTokenParser</span><span class="o">(</span><span class="s">&quot;#{&quot;</span><span class="o">,</span> <span class="s">&quot;}&quot;</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span><span class="line">    <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">originalSql</span><span class="o">);</span>
</span><span class="line">    <span class="k">return</span> <span class="k">new</span> <span class="nf">StaticSqlSource</span><span class="o">(</span><span class="n">configuration</span><span class="o">,</span> <span class="n">sql</span><span class="o">,</span> <span class="n">handler</span><span class="o">.</span><span class="na">getParameterMappings</span><span class="o">());</span>
</span><span class="line">  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>在parse方法里又创建了GenericTokenParser类，然后调用它的parse方法去解析SQL。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>GenericTokenParser.java  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">  <span class="kd">public</span> <span class="n">String</span> <span class="nf">parse</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="n">StringBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
</span><span class="line">    <span class="k">if</span> <span class="o">(</span><span class="n">text</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">      <span class="n">String</span> <span class="n">after</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
</span><span class="line">      <span class="kt">int</span> <span class="n">start</span> <span class="o">=</span> <span class="n">after</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">openToken</span><span class="o">);</span>
</span><span class="line">      <span class="kt">int</span> <span class="n">end</span> <span class="o">=</span> <span class="n">after</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">closeToken</span><span class="o">);</span>
</span><span class="line">      <span class="k">while</span> <span class="o">(</span><span class="n">start</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">end</span> <span class="o">&gt;</span> <span class="n">start</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">          <span class="n">String</span> <span class="n">before</span> <span class="o">=</span> <span class="n">after</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">start</span><span class="o">);</span>
</span><span class="line">          <span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">after</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">openToken</span><span class="o">.</span><span class="na">length</span><span class="o">(),</span> <span class="n">end</span><span class="o">);</span>
</span><span class="line">          <span class="n">String</span> <span class="n">substitution</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="na">handleToken</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
</span><span class="line">          <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">before</span><span class="o">);</span>
</span><span class="line">          <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">substitution</span><span class="o">);</span>
</span><span class="line">          <span class="n">after</span> <span class="o">=</span> <span class="n">after</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">end</span> <span class="o">+</span> <span class="n">closeToken</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
</span><span class="line">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">end</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">          <span class="n">String</span> <span class="n">before</span> <span class="o">=</span> <span class="n">after</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">end</span><span class="o">);</span>
</span><span class="line">          <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">before</span><span class="o">);</span>
</span><span class="line">          <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">closeToken</span><span class="o">);</span>
</span><span class="line">          <span class="n">after</span> <span class="o">=</span> <span class="n">after</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">end</span> <span class="o">+</span> <span class="n">closeToken</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
</span><span class="line">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class="line">          <span class="k">break</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="n">start</span> <span class="o">=</span> <span class="n">after</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">openToken</span><span class="o">);</span>
</span><span class="line">        <span class="n">end</span> <span class="o">=</span> <span class="n">after</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">closeToken</span><span class="o">);</span>
</span><span class="line">      <span class="o">}</span>
</span><span class="line">      <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">after</span><span class="o">);</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
</span><span class="line">  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>parse方法的目的和iBatis是一样的，是要把形如</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sql"><span class="line"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">TABLE</span> <span class="k">WHERE</span> <span class="n">ID</span> <span class="o">=</span> <span class="o">#</span><span class="err">{</span><span class="n">ID</span><span class="err">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>转换成</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sql"><span class="line"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">TABLE</span> <span class="k">WHERE</span> <span class="n">ID</span> <span class="o">=</span> <span class="err">？</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>到这里为止，整个解析过程就结束了，所有解析得到的配置都会保存到MappedStatement类中。</p>

<p><strong>总结</strong></p>

<p>这篇博文是iBatis和myBatis源码分析系列的最后一篇，也是最长的一篇。我觉得这只能算是粗略的源码分析，因为只分析了主要的几个部分，其他非常细节的地方并没有去做研究。四篇博文写下来给我的感觉是myBatis在代码结构和质量上相较iBatis都有比较大的提高，但是有些地方还是感觉有点复杂和罗嗦，代码读起来不是那么的清晰。有些类中的重载方法非常多，如果可以适当减少一些的话可以提高代码的可读性；还有可以对参数绑定做一个归纳，减少BaseTypeHandler类的实现类等。</p>

<p>虽然iBatis或者myBatis很轻量也很好用，但是就像我在第一篇概览中说的那样，现在Java平台上ORM框架大多数都是基于POJO和XML之上的，这样做的后果就是对象贫血，开放速度变慢。POJO什么时候会被抛弃我不知道，但是我相信会有那一天的。</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/23/ibatis-source-code-analysis-mapping/">iBatis源码分析之映射</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-23T19:14:00+08:00" pubdate data-updated="true">Oct 23<span>rd</span>, 2011</time>
        
         | <a href="/blog/2011/10/23/ibatis-source-code-analysis-mapping/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>1.包结构分析</strong></p>

<table border="1" width="100%" cellpadding="3" cellspacing="0" summary="">
<tbody><tr>
<th align="left" colspan="2" style="background-color:#CCCCFF">
<b>Packages</b></th></tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.builder.xml</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.common.xml</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.mapping.parameter</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.mapping.result</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.mapping.result.loader</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.mapping.sql</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.mapping.sql.dynamic</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.mapping.sql.dynamic.elements</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.mapping.sql.raw</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.mapping.sql.simple</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.mapping.sql.stat</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.mapping.statement</b></td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>

<p>iBatis处理映射的包结构应该说还是比较清晰的，基本上看到包名就可以知道包下面的类是做什么用的。但是我们看到关于映射的包一共有10个，但是像dynamic，raw，simple，stat这些包下都只有一个类，显然这种分法是有问题的，我们应当尽可能地减少包，包越少结构就越清晰，但并不是说把类都放一个包下，要在这两者之间寻求平衡。 </div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/10/23/ibatis-source-code-analysis-mapping/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/16/ascii-unicode-utf-8/">ASCII，Unicode和UTF-8的编码方式</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-16T18:57:00+08:00" pubdate data-updated="true">Oct 16<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/10/16/ascii-unicode-utf-8/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>原文地址：<a href="http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html" title="http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html">http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html</a></p>

<p><strong>1.ASCII码</strong></p>

<p>我们知道，在计算机内部，所有的信息最终都表示为一个二进制的字符串。每一个二进制位（bit）有0和1两种状态，因此八个二进制位就可以组合出256种状态，这被称为一个字节（byte）。也就是说，一个字节一共可以用来表示256种不同的状态，每一个状态对应一个符号，就是256个符号，从0000000到11111111。上个世纪60年代，美国制定了一套字符编码，对英语字符与二进制位之间的关系，做了统一规定。这被称为ASCII码，一直沿用至今。ASCII码一共规定了128个字符的编码，比如空格“SPACE”是32（二进制00100000），大写的字母A是65（二进制01000001）。这128个符号（包括32个不能打印出来的控制符号），只占用了一个字节的后面7位，最前面的1位统一规定为0。 </div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/10/16/ascii-unicode-utf-8/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/06/rip-steve-jobs/">史蒂夫·乔布斯,R.I.P</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-06T18:46:00+08:00" pubdate data-updated="true">Oct 6<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/10/06/rip-steve-jobs/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>多年以前，当我听说乔布斯患上癌症时，我简直不敢相信我的耳朵。在大学的时候，我就买了第一代的iPod。当时它那超薄的机身以及旋转式触摸按键让我惊为神器，爱不释手。几年过去，iPhone横空出世，虽然我没有买过iPhone,但还是被乔布斯的创造力所折服。如今，iPad又带来了一股平板电脑的旋风，人们争相购买。可以这么说，乔布斯在不断地改变人们的生活方式，在不断地改变着这个世界。</p>

<p>但是今天是一个灰暗的日子，乔布斯离开了我们，我们无比悲伤。但是逝者已矣，乔布斯留给我们的是他那对创新的孜孜不倦，热爱自己喜欢的工作，“stay hungry, stay foolish”是他一生最好的注解。下面是乔布斯于2005年在斯坦福毕业典礼上的演讲全文，谨以此文与喜欢乔布斯的朋友共勉：stay hungry， stay foolish。 </div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/10/06/rip-steve-jobs/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/09/16/ibatis-and-mybatis-source-code-analysis-cache/">iBatis和myBatis源码分析之缓存</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-16T18:41:00+08:00" pubdate data-updated="true">Sep 16<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/09/16/ibatis-and-mybatis-source-code-analysis-cache/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>一.iBatis</strong></p>

<p>1.iBatis的cache包结构：</p>

<table border="1" width="100%" cellpadding="3" cellspacing="0" summary="">
<tbody>
<tr>
<th align="left" colspan="2" style="background-color:#CCCCFF">
<b>Packages</b>
</th>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.cache</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.cache.fifo</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.cache.lru</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.cache.memory</b></td>
<td>&nbsp;</td>
</tr>
<tr bgcolor="white">
<td width="20%"><b>com.ibatis.sqlmap.engine.cache.oscache</b></td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>

<p>iBatis已实现的四个CacheController类分别是：</p>

<ul>
  <li>FifoCacheController</li>
  <li>LruCacheController</li>
  <li>MemoryCacheController</li>
  <li>OSCacheController</li>
</ul>

<p>其中，前三种是最常用的缓存策略，第四种是对<a href="http://java.net/projects/oscache" title="OSCache">OSCache</a>的支持。当然，你也可以根据需要实现自己的缓存策略，只需要实现CacheController接口就可以了。 </div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/09/16/ibatis-and-mybatis-source-code-analysis-cache/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/4/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
<h1>Twitter</h1>
<ul>
<li>
<a href="http://twitter.com/comomt">Follow me on twitter</a>
</li>
</ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/10/21/hashing-myths/">Hashing神话</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/20/string-searching-algorithms/">字符串搜索算法</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/26/skip-list-in-a-netshell/">Skip List原理简述</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/18/head-first-coroutine/">深入浅出Coroutine</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/17/install-munin-on-vps/">用Munin监控VPS的运行情况</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/algorithms/'>algorithms (3)</a></li>
<li class='category'><a href='/blog/categories/architecture/'>architecture (4)</a></li>
<li class='category'><a href='/blog/categories/browsers/'>browsers (10)</a></li>
<li class='category'><a href='/blog/categories/java/'>java (10)</a></li>
<li class='category'><a href='/blog/categories/life/'>life (8)</a></li>
<li class='category'><a href='/blog/categories/linux/'>linux (1)</a></li>
<li class='category'><a href='/blog/categories/nosql/'>nosql (1)</a></li>
<li class='category'><a href='/blog/categories/notes/'>notes (4)</a></li>
<li class='category'><a href='/blog/categories/octopress/'>octopress (2)</a></li>
<li class='category'><a href='/blog/categories/opensource/'>opensource (7)</a></li>
<li class='category'><a href='/blog/categories/programming/'>programming (7)</a></li>
<li class='category'><a href='/blog/categories/vim/'>vim (1)</a></li>
<li class='category'><a href='/blog/categories/vps/'>vps (4)</a></li>

  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">
<img alt="Creative Commons License" style="border-width:0;" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a><br/>
Blog content is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.<br/>
  Copyright &copy; 2012 - Foredoomed -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=8495631; 
var sc_invisible=0; 
var sc_security="5b0817e1"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost +
"statcounter.com/counter/counter_xhtml.js'></"+"script>");</script>
<noscript><div class="statcounter"><a title="free hit
counters" href="http://statcounter.com/"
class="statcounter"><img class="statcounter"
src="https://c.statcounter.com/8495631/0/5b0817e1/0/"
alt="free hit counters" /></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'zhixingheyi';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







</body>
</html>
