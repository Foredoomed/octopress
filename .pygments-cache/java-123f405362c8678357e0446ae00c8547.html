<div class="highlight"><pre><span class="n">MappedStatementConfig</span><span class="o">(</span><span class="n">SqlMapConfiguration</span> <span class="n">config</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="n">MappedStatement</span> <span class="n">statement</span><span class="o">,</span> <span class="n">SqlSource</span> <span class="n">processor</span><span class="o">,</span>
                        <span class="n">String</span> <span class="n">parameterMapName</span><span class="o">,</span> <span class="n">Class</span> <span class="n">parameterClass</span><span class="o">,</span> <span class="n">String</span> <span class="n">resultMapName</span><span class="o">,</span>
                        <span class="n">String</span><span class="o">[]</span> <span class="n">additionalResultMapNames</span><span class="o">,</span> <span class="n">Class</span> <span class="n">resultClass</span><span class="o">,</span> <span class="n">Class</span><span class="o">[]</span> <span class="n">additionalResultClasses</span><span class="o">,</span>
                        <span class="n">String</span> <span class="n">cacheModelName</span><span class="o">,</span> <span class="n">String</span> <span class="n">resultSetType</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">fetchSize</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">allowRemapping</span><span class="o">,</span>
                        <span class="n">Integer</span> <span class="n">timeout</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">defaultStatementTimeout</span><span class="o">,</span> <span class="n">String</span> <span class="n">xmlResultName</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">errorContext</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="na">getErrorContext</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">client</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="na">getClient</span><span class="o">();</span>
    <span class="n">SqlMapExecutorDelegate</span> <span class="n">delegate</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getDelegate</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">typeHandlerFactory</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="na">getTypeHandlerFactory</span><span class="o">();</span>
    <span class="n">errorContext</span><span class="o">.</span><span class="na">setActivity</span><span class="o">(</span><span class="s">&quot;parsing a mapped statement&quot;</span><span class="o">);</span>
    <span class="n">errorContext</span><span class="o">.</span><span class="na">setObjectId</span><span class="o">(</span><span class="n">id</span> <span class="o">+</span> <span class="s">&quot; statement&quot;</span><span class="o">);</span>
    <span class="n">errorContext</span><span class="o">.</span><span class="na">setMoreInfo</span><span class="o">(</span><span class="s">&quot;Check the result map name.&quot;</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">resultMapName</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">statement</span><span class="o">.</span><span class="na">setResultMap</span><span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">getDelegate</span><span class="o">().</span><span class="na">getResultMap</span><span class="o">(</span><span class="n">resultMapName</span><span class="o">));</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">additionalResultMapNames</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">additionalResultMapNames</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
          <span class="n">statement</span><span class="o">.</span><span class="na">addResultMap</span><span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">getDelegate</span><span class="o">().</span><span class="na">getResultMap</span><span class="o">(</span><span class="n">additionalResultMapNames</span><span class="o">[</span><span class="n">i</span><span class="o">]));</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">errorContext</span><span class="o">.</span><span class="na">setMoreInfo</span><span class="o">(</span><span class="s">&quot;Check the parameter map name.&quot;</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">parameterMapName</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">statement</span><span class="o">.</span><span class="na">setParameterMap</span><span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">getDelegate</span><span class="o">().</span><span class="na">getParameterMap</span><span class="o">(</span><span class="n">parameterMapName</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="n">statement</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="n">statement</span><span class="o">.</span><span class="na">setResource</span><span class="o">(</span><span class="n">errorContext</span><span class="o">.</span><span class="na">getResource</span><span class="o">());</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">resultSetType</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="s">&quot;FORWARD_ONLY&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">resultSetType</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">statement</span><span class="o">.</span><span class="na">setResultSetType</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="n">ResultSet</span><span class="o">.</span><span class="na">TYPE_FORWARD_ONLY</span><span class="o">));</span>
      <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="s">&quot;SCROLL_INSENSITIVE&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">resultSetType</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">statement</span><span class="o">.</span><span class="na">setResultSetType</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="n">ResultSet</span><span class="o">.</span><span class="na">TYPE_SCROLL_INSENSITIVE</span><span class="o">));</span>
      <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="s">&quot;SCROLL_SENSITIVE&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">resultSetType</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">statement</span><span class="o">.</span><span class="na">setResultSetType</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="n">ResultSet</span><span class="o">.</span><span class="na">TYPE_SCROLL_SENSITIVE</span><span class="o">));</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">fetchSize</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">statement</span><span class="o">.</span><span class="na">setFetchSize</span><span class="o">(</span><span class="n">fetchSize</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// set parameter class either from attribute or from map (make sure to match)</span>
    <span class="n">ParameterMap</span> <span class="n">parameterMap</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="na">getParameterMap</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">parameterMap</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">statement</span><span class="o">.</span><span class="na">setParameterClass</span><span class="o">(</span><span class="n">parameterClass</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">statement</span><span class="o">.</span><span class="na">setParameterClass</span><span class="o">(</span><span class="n">parameterMap</span><span class="o">.</span><span class="na">getParameterClass</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="c1">// process SQL statement, including inline parameter maps</span>
    <span class="n">errorContext</span><span class="o">.</span><span class="na">setMoreInfo</span><span class="o">(</span><span class="s">&quot;Check the SQL statement.&quot;</span><span class="o">);</span>
    <span class="n">Sql</span> <span class="n">sql</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="na">getSql</span><span class="o">();</span>
    <span class="n">setSqlForStatement</span><span class="o">(</span><span class="n">statement</span><span class="o">,</span> <span class="n">sql</span><span class="o">);</span>

    <span class="c1">// set up either null result map or automatic result mapping</span>
    <span class="n">ResultMap</span> <span class="n">resultMap</span> <span class="o">=</span> <span class="o">(</span><span class="n">ResultMap</span><span class="o">)</span> <span class="n">statement</span><span class="o">.</span><span class="na">getResultMap</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">resultMap</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">resultClass</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">statement</span><span class="o">.</span><span class="na">setResultMap</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">resultMap</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">resultMap</span> <span class="o">=</span> <span class="n">buildAutoResultMap</span><span class="o">(</span><span class="n">allowRemapping</span><span class="o">,</span> <span class="n">statement</span><span class="o">,</span> <span class="n">resultClass</span><span class="o">,</span> <span class="n">xmlResultName</span><span class="o">);</span>
      <span class="n">statement</span><span class="o">.</span><span class="na">setResultMap</span><span class="o">(</span><span class="n">resultMap</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">additionalResultClasses</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">additionalResultClasses</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
          <span class="n">statement</span><span class="o">.</span><span class="na">addResultMap</span><span class="o">(</span><span class="n">buildAutoResultMap</span><span class="o">(</span><span class="n">allowRemapping</span><span class="o">,</span> <span class="n">statement</span><span class="o">,</span> <span class="n">additionalResultClasses</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">xmlResultName</span><span class="o">));</span>
        <span class="o">}</span>
      <span class="o">}</span>

    <span class="o">}</span>
    
    <span class="o">...</span>
<span class="o">}</span>
</pre></div>